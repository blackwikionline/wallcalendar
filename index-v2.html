<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Family Calendar</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Georgia, serif; }
    body { background: #fdf2f4; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    h1 { font-style: italic; color: #333; font-size: 2.5rem; }
    .status { color: #666; margin-top: 1rem; }
    .spinner { margin-top: 1.5rem; width: 50px; height: 50px; border: 4px solid #ff6b9d; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .wifi-btn { position: fixed; bottom: 20px; right: 20px; background: #666; color: #fff; border: none; padding: 12px 20px; border-radius: 10px; font-size: 1rem; cursor: pointer; }
    .wifi-btn:active { transform: scale(0.95); }
    .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 100; }
    .modal-bg.show { display: flex; }
    .modal { background: #fff; padding: 24px; border-radius: 16px; width: 90%; max-width: 400px; }
    .modal h2 { font-size: 1.5rem; margin-bottom: 16px; color: #333; }
    .modal label { display: block; font-size: 0.9rem; color: #666; margin-bottom: 4px; }
    .modal input { width: 100%; padding: 14px; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 12px; }
    .modal input:focus { outline: none; border-color: #ff6b9d; }
    .modal .status-msg { text-align: center; margin-bottom: 12px; color: #666; }
    .modal .btns { display: flex; gap: 10px; margin-bottom: 10px; }
    .modal button { flex: 1; padding: 14px; font-size: 1.1rem; border: none; border-radius: 10px; cursor: pointer; }
    .modal button:active { transform: scale(0.95); }
    .btn-save { background: #3b82f6; color: #fff; }
    .btn-connect { background: #22c55e; color: #fff; }
    .btn-close { background: #e5e5e5; color: #333; }
    .keyboard { position: fixed; bottom: 0; left: 0; right: 0; background: #1f2937; padding: 10px 10px 20px; z-index: 200; display: none; }
    .keyboard.show { display: block; }
    .kb-row { display: flex; justify-content: center; gap: 4px; margin-bottom: 4px; }
    .kb-key { padding: 14px 12px; min-width: 36px; background: #4b5563; color: #fff; border: none; border-radius: 6px; font-size: 1.1rem; cursor: pointer; }
    .kb-key:active { background: #ff6b9d; }
    .kb-key.active { background: #ff6b9d; }
    .kb-space { flex: 1; max-width: 250px; }
    .kb-close { background: #4b5563; color: #fff; border: none; padding: 8px 20px; border-radius: 6px; margin-bottom: 10px; }
        .splash-container {
      text-align: center;
    }
    
    .splash-image {
      max-width: 80vw;
      max-height: 70vh;
      object-fit: contain;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    }
    
    .loading-text {
      margin-top: 2rem;
      color: #ad1457;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid #f8bbd9;
      border-top-color: #ad1457;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- <h1>Family Calendar</h1> -->
   <div class="splash-container">
    <img src="splash.png" alt="Family Calendar" class="splash-image">
    
  </div>
  <p class="status" id="status">Loading...</p>
  <div class="spinner" id="spinner"></div>
  
  <button class="wifi-btn" onclick="showWifi()">‚öôÔ∏è WiFi</button>

  <div class="modal-bg" id="modal" onclick="hideWifi()">
    <div class="modal" onclick="event.stopPropagation()">
      <h2>üì∂ WiFi Setup</h2>
      <label>Network Name (SSID)</label>
      <input type="text" id="ssid" placeholder="Tap to enter..." onfocus="openKb('ssid')" readonly>
      <label>Password</label>
      <input type="password" id="password" placeholder="Tap to enter..." onfocus="openKb('password')" readonly>
      <p class="status-msg" id="wifiStatus"></p>
      <div class="btns">
        <button class="btn-save" onclick="saveWifi()">Save</button>
        <button class="btn-connect" onclick="connectWifi()">Connect</button>
      </div>
      <button class="btn-close" onclick="hideWifi()">Close</button>
    </div>
  </div>

  <div class="keyboard" id="keyboard">
    <div style="text-align:center">
      <button class="kb-close" onclick="closeKb()">Close Keyboard</button>
      <button class="kb-close" id="symToggle" onclick="toggleSym()">!@#</button>
    </div>
    <div id="kbRows"></div>
  </div>

  <script>
    const SERVER = 'http://localhost:3000';
    let checkCount = 0;
    let activeField = null;
    let shift = false;
    let symbols = false;

    const letters = [
      ['1','2','3','4','5','6','7','8','9','0'],
      ['q','w','e','r','t','y','u','i','o','p'],
      ['a','s','d','f','g','h','j','k','l'],
      ['z','x','c','v','b','n','m']
    ];
    const syms = [
      ['!','@','#','$','%','^','&','*','(',')'],
      ['-','_','=','+','[',']','{','}','|','\\'],
      [';',':','"',"'",'<','>',',','.','/'],
      ['~','`','?','!']
    ];

    function buildKb() {
      const rows = symbols ? syms : letters;
      let html = '';
      rows.forEach((row, i) => {
        html += '<div class="kb-row">';
        if (i === 3 && !symbols) html += `<button class="kb-key ${shift?'active':''}" onclick="toggleShift()">‚áß</button>`;
        row.forEach(k => {
          const char = (shift && !symbols) ? k.toUpperCase() : k;
          html += `<button class="kb-key" onclick="typeKey('${k}')">${char}</button>`;
        });
        if (i === 3) html += '<button class="kb-key" onclick="backspace()">‚å´</button>';
        html += '</div>';
      });
      html += '<div class="kb-row"><button class="kb-key kb-space" onclick="typeKey(\' \')">Space</button><button class="kb-key" style="background:#ff6b9d" onclick="closeKb()">Done</button></div>';
      document.getElementById('kbRows').innerHTML = html;
      document.getElementById('symToggle').textContent = symbols ? 'ABC' : '!@#';
    }

    function openKb(field) {
      activeField = field;
      document.getElementById('keyboard').classList.add('show');
      buildKb();
    }

    function closeKb() {
      document.getElementById('keyboard').classList.remove('show');
      activeField = null;
    }

    function typeKey(k) {
      if (!activeField) return;
      const el = document.getElementById(activeField);
      const char = (shift && !symbols) ? k.toUpperCase() : k;
      el.value += char;
      shift = false;
      buildKb();
    }

    function backspace() {
      if (!activeField) return;
      const el = document.getElementById(activeField);
      el.value = el.value.slice(0, -1);
    }

    function toggleShift() {
      shift = !shift;
      buildKb();
    }

    function toggleSym() {
      symbols = !symbols;
      buildKb();
    }

    function showWifi() {
      document.getElementById('modal').classList.add('show');
    }

    function hideWifi() {
      document.getElementById('modal').classList.remove('show');
      closeKb();
    }

    function setWifiStatus(msg) {
      document.getElementById('wifiStatus').textContent = msg;
    }

    async function saveWifi() {
      const ssid = document.getElementById('ssid').value;
      const password = document.getElementById('password').value;
      if (!ssid) { setWifiStatus('Enter SSID'); return; }
      setWifiStatus('Saving...');
      try {
        const r = await fetch(`${SERVER}/api/wifi`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ssid, password })
        });
        setWifiStatus(r.ok ? 'Saved! ‚úì' : 'Error saving');
      } catch (e) {
        setWifiStatus('Error: ' + e.message);
      }
    }

    async function connectWifi() {
      const ssid = document.getElementById('ssid').value;
      const password = document.getElementById('password').value;
      if (!ssid) { setWifiStatus('Enter SSID'); return; }
      setWifiStatus('Connecting...');
      try {
        const r = await fetch(`${SERVER}/api/wifi/connect`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ssid, password })
        });
        const d = await r.json();
        setWifiStatus(r.ok ? 'Connected! ‚úì Retrying...' : 'Error: ' + d.error);
        if (r.ok) setTimeout(checkServer, 2000);
      } catch (e) {
        setWifiStatus('Error: ' + e.message);
      }
    }

    async function checkServer() {
      checkCount++;
      document.getElementById('status').textContent = `Connecting... (${checkCount})`;
      
      try {
        const r = await fetch(SERVER);
        const html = await r.text();
        if (html.includes('Family Calendar')) {
          document.getElementById('status').textContent = 'Ready!';
          window.location.href = SERVER;
          return;
        }
      } catch (e) {}

      // Show WiFi modal after 10 seconds (10 attempts)
      if (checkCount >= 10) {
        document.getElementById('status').textContent = 'Cannot connect - check WiFi';
        document.getElementById('spinner').style.display = 'none';
        showWifi();
      } else {
        setTimeout(checkServer, 1000);
      }
    }

    checkServer();
  </script>
</body>
</html>
